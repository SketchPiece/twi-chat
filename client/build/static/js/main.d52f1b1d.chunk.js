(this["webpackJsonptwi-react"]=this["webpackJsonptwi-react"]||[]).push([[0],{148:function(e,t,a){},177:function(e,t,a){},178:function(e,t,a){},207:function(e,t){},210:function(e,t,a){},212:function(e,t,a){},213:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),s=a(43),c=a.n(s),l=(a(93),a(5)),i=a(18),o=a(6),u=a.n(o),m=a(13),d=a(8),f=a(3),v=a(2),b=a(14),p=["bounceIn","bounceInLeft","bounceInRight","bounceInUp"];var h=function(){return p[function(e,t){var a=e-.5+Math.random()*(t-e+1);return Math.round(a)}(0,p.length-1)]},E=function(){var e=document.getElementById("msgs");e.scrollTo(0,e.scrollHeight-e.offsetHeight)},g=function(e,t){return e?t?"https://res.cloudinary.com/sketchcorp/image/upload/c_fill,h_".concat(t,",w_").concat(t,"/").concat(e):"https://res.cloudinary.com/sketchcorp/image/upload/".concat(e):"/images/load.gif"},O=function(e){switch(e){case"dev":return r.a.createElement("div",{className:"tag dev"},"Dev");case"+":return r.a.createElement("div",{className:"tag confirmed"},"\u2714");default:return""}},j=(a(148),a(80)),w=a.n(j),N=function(){var e=Object(n.useState)(!1),t=Object(v.a)(e,2),a=t[0],r=t[1],s=Object(n.useState)(null),c=Object(v.a)(s,2),l=c[0],i=c[1];return{loading:a,request:Object(n.useCallback)(function(){var e=Object(m.a)(u.a.mark((function e(t){var a,n,s,c,l,o=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>1&&void 0!==o[1]?o[1]:"GET",n=o.length>2&&void 0!==o[2]?o[2]:null,s=o.length>3&&void 0!==o[3]?o[3]:{},r(!0),e.prev=4,n&&(n=JSON.stringify(n),s["Content-Type"]="application/json"),e.next=8,fetch(t,{method:a,body:n,headers:s});case 8:return c=e.sent,e.next=11,c.json();case 11:if(l=e.sent,c.ok){e.next=14;break}throw new Error(l.message||l||"\u0427\u0442\u043e \u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a");case 14:return r(!1),e.abrupt("return",l);case 18:throw e.prev=18,e.t0=e.catch(4),r(!1),i(e.t0.message),e.t0;case 23:case"end":return e.stop()}}),e,null,[[4,18]])})));return function(t){return e.apply(this,arguments)}}(),[]),requestFormData:Object(n.useCallback)(function(){var e=Object(m.a)(u.a.mark((function e(t){var a,n,s,c,l=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:"GET",n=l.length>2&&void 0!==l[2]?l[2]:new FormData,s=l.length>3&&void 0!==l[3]?l[3]:{},r(!0),e.prev=4,s["Content-Type"]="application/x-www-form-urlencoded",e.next=8,w()({url:t,method:a,headers:s,data:n});case 8:return c=e.sent,r(!1),e.abrupt("return",c);case 13:throw e.prev=13,e.t0=e.catch(4),console.log(e.t0),r(!1),i(e.t0.message),e.t0;case 19:case"end":return e.stop()}}),e,null,[[4,13]])})));return function(t){return e.apply(this,arguments)}}(),[]),error:l,clearError:Object(n.useCallback)((function(){return i(null)}),[])}};function k(){}var y=Object(n.createContext)({token:null,userId:null,login:k,logout:k,reload:k,isAuthenticated:!1});function I(){var e=Object(n.useContext)(y),t=Object(n.useState)({username:"",password:""}),a=Object(v.a)(t,2),s=a[0],c=a[1],i=Object(n.useState)(0),o=Object(v.a)(i,2),p=o[0],E=o[1],g=Object(n.useState)(""),O=Object(v.a)(g,2),j=O[0],w=O[1],k=Object(n.useState)({username:0,password:0}),I=Object(v.a)(k,2),x=I[0],S=I[1],C=N(),_=C.loading,A=C.request,P=function(e){e.target.classList.remove("input-red"),E(0),c(Object(f.a)({},s,Object(d.a)({},e.target.name,e.target.value)))},D=function(){var t=Object(m.a)(u.a.mark((function t(a){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.preventDefault(),S(Object(f.a)({},x,{username:0,password:0})),s.username){t.next=7;break}return E(1),w("\u041b\u043e\u0433\u0438\u043d \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u043f\u043e\u043b\u0435!"),S(Object(f.a)({},x,{username:1})),t.abrupt("return");case 7:if(s.password){t.next=12;break}return E(1),w("\u041f\u0430\u0440\u043e\u043b\u044c \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u043f\u043e\u043b\u0435!"),S(Object(f.a)({},x,{password:1})),t.abrupt("return");case 12:return t.prev=12,t.next=15,A("/api/auth/login","POST",Object(f.a)({},s));case 15:n=t.sent,e.login(n.token,n.userId,n.username),t.next=25;break;case 19:t.prev=19,t.t0=t.catch(12),console.log(t.t0.message),E(1),w(t.t0.message),S(Object(f.a)({},x,{username:1,password:1,repPassword:1}));case 25:case"end":return t.stop()}}),t,null,[[12,19]])})));return function(e){return t.apply(this,arguments)}}(),L=function(e){switch(x[e]){case 0:return"";case 1:return"animated shake fast input-red";case 2:return"input-red";default:return""}};return r.a.createElement("form",{className:"fullheight"},r.a.createElement(b.Animated,{style:{height:"100%"},animationIn:h(),isVisible:!0},r.a.createElement("div",{className:"auth-container"},r.a.createElement("div",{className:"wrapper"},r.a.createElement("h2",null,"TwiChat v0.8"),r.a.createElement("span",{className:function(){switch(p){case 0:return"warn-hide";case 1:return"warning animated fadeIn";case 2:return"warning";default:return""}}(),onAnimationEnd:function(){E(2)}},j),r.a.createElement("div",{className:"left"},r.a.createElement("label",{htmlFor:"username"},"\u041b\u043e\u0433\u0438\u043d")),r.a.createElement("input",{autoComplete:"login",id:"username",name:"username",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u0438\u043a",type:"text",value:s.username,onChange:P,className:L("username"),onAnimationEnd:function(){S(Object(f.a)({},x,{username:2}))}}),r.a.createElement("div",{className:"left"},r.a.createElement("label",{htmlFor:"password"},"\u041f\u0430\u0440\u043e\u043b\u044c")),r.a.createElement("input",{autoComplete:"password",id:"password",name:"password",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c",type:"password",value:s.password,onChange:P,className:L("password"),onAnimationEnd:function(){S(Object(f.a)({},x,{password:2}))}}),r.a.createElement("button",{onClick:D,disabled:_},"\u0412\u043e\u0439\u0442\u0438"),r.a.createElement(l.b,{to:"/register"},"\u0415\u0449\u0435 \u043d\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b?")))))}function x(){var e=Object(n.useContext)(y),t=Object(n.useState)({username:"",password:"",repPassword:""}),a=Object(v.a)(t,2),s=a[0],c=a[1],i=Object(n.useState)(0),o=Object(v.a)(i,2),p=o[0],h=o[1],E=Object(n.useState)(""),g=Object(v.a)(E,2),O=g[0],j=g[1],w=Object(n.useState)({username:0,password:0,repPassword:0}),k=Object(v.a)(w,2),I=k[0],x=k[1],S=N(),C=S.loading,_=S.request,A=function(e){e.target.classList.remove("input-red"),h(0),c(Object(f.a)({},s,Object(d.a)({},e.target.name,e.target.value.trim())))},P=function(){var t=Object(m.a)(u.a.mark((function t(a){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.preventDefault(),x(Object(f.a)({},I,{username:0,password:0,repPassword:0})),s.username){t.next=7;break}return h(1),j("\u041b\u043e\u0433\u0438\u043d \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u043f\u043e\u043b\u0435!"),x(Object(f.a)({},I,{username:1})),t.abrupt("return");case 7:if(!s.username.includes(" ")){t.next=12;break}return h(1),j("\u041b\u043e\u0433\u0438\u043d \u043d\u0435 \u0434\u043e\u0436\u0435\u043d \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c \u043f\u0440\u043e\u0431\u0435\u043b\u043e\u0432!"),x(Object(f.a)({},I,{username:1})),t.abrupt("return");case 12:if(s.password){t.next=17;break}return h(1),j("\u041f\u0430\u0440\u043e\u043b\u044c \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u043f\u043e\u043b\u0435!"),x(Object(f.a)({},I,{password:1})),t.abrupt("return");case 17:if(s.password===s.repPassword){t.next=22;break}return h(1),x(Object(f.a)({},I,{password:1,repPassword:1})),j("\u041f\u0430\u0440\u043e\u043b\u0438 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442!"),t.abrupt("return");case 22:return t.prev=22,t.next=25,_("/api/auth/register","POST",Object(f.a)({},s));case 25:n=t.sent,e.login(n.token,n.userId,n.username),t.next=35;break;case 29:t.prev=29,t.t0=t.catch(22),console.log(t.t0.message),h(1),j(t.t0.message),x(Object(f.a)({},I,{username:1,password:1,repPassword:1}));case 35:case"end":return t.stop()}}),t,null,[[22,29]])})));return function(e){return t.apply(this,arguments)}}(),D=function(e){switch(I[e]){case 0:return"";case 1:return"animated shake fast input-red";case 2:return"input-red";default:return""}};return r.a.createElement("form",{className:"fullheight"},r.a.createElement(b.Animated,{style:{height:"100%"},animationIn:"fadeIn",isVisible:!0},r.a.createElement("div",{className:"auth-container"},r.a.createElement("div",{className:"wrapper"},r.a.createElement("h2",null,"TwiChat v0.8"),r.a.createElement("span",{className:function(){switch(p){case 0:return"warn-hide";case 1:return"warning animated fadeIn";case 2:return"warning";default:return""}}(),onAnimationEnd:function(){h(2)}},O),r.a.createElement("div",{className:"left"},r.a.createElement("label",{htmlFor:"username"},"\u041b\u043e\u0433\u0438\u043d")),r.a.createElement("input",{autoComplete:"login",id:"username",name:"username",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u0438\u043a",type:"text",onChange:A,className:D("username"),onAnimationEnd:function(){x(Object(f.a)({},I,{username:2}))}}),r.a.createElement("div",{className:"left"},r.a.createElement("label",{htmlFor:"password"},"\u041f\u0430\u0440\u043e\u043b\u044c")),r.a.createElement("input",{autoComplete:"password",id:"password",name:"password",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c",type:"password",onChange:A,className:D("password"),onAnimationEnd:function(){x(Object(f.a)({},I,{password:2}))}}),r.a.createElement("div",{className:"left"},r.a.createElement("label",{htmlFor:"repPassword"},"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c")),r.a.createElement("input",{autoComplete:"repPassword",id:"repPassword",name:"repPassword",placeholder:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c",type:"password",onChange:A,className:D("repPassword"),onAnimationEnd:function(){x(Object(f.a)({},I,{repPassword:2}))}}),r.a.createElement("button",{onClick:P,disabled:C},"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"),r.a.createElement(l.b,{to:"/login"},"\u0423\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b?")))))}var S=a(31),C=a(17),_=a(83),A=a(0),P=Object(n.createContext)({userId:null,username:null,avatar:null,status:null,tag:null,load:null});function D(e){var t,a=e.viewState,s=e.chatSwitch,c=e.hide,o=e.socket,u=e.chats,m=e.chatRoute,d=Object(n.useContext)(P),f=d.username,v=d.avatar,b=d.load,p=Object(n.useContext)(y),h=Object(i.g)();return r.a.createElement("div",{id:"side-bar",className:a?" ":"side-bar-hide",style:c?{zIndex:-1}:{zIndex:0}},r.a.createElement("div",{className:"heading"},r.a.createElement("div",{id:"back",onClick:function(){s()}}," ",r.a.createElement(C.a,null)," "),r.a.createElement("div",{className:"app-name"},"TwiChat v0.8 Beta"),r.a.createElement("div",{className:"menu"},m?r.a.createElement(A.b.Provider,{value:{color:"white",size:"20px"}},r.a.createElement(l.b,{onClick:function(){s()},to:"/profile"},r.a.createElement(C.d,{className:"react-button"}))):r.a.createElement(A.b.Provider,{value:{color:"white",size:"20px"}},r.a.createElement(l.b,{onClick:function(){s()},to:"/chat"},r.a.createElement(_.a,{className:"react-button"}))))),r.a.createElement("div",{className:"users"},r.a.createElement("div",{className:"user active"},r.a.createElement("div",{className:"user-photo"},"C"),r.a.createElement("div",{className:"user-info"},r.a.createElement("div",{className:"name"},"Community"),r.a.createElement("div",{className:"last-message"},u[t="community"]&&u[t].last?u[t].last.username===f?"\u0422\u044b: ".concat(u[t].last.text):"".concat(u[t].last.username,": ").concat(u[t].last.text):"")))),r.a.createElement("div",{className:"current-user"},r.a.createElement("div",{className:"user-container"},r.a.createElement(l.b,{to:"/profile"},r.a.createElement("img",{className:"avatar"+(b?" none":" animated slideInRight"),src:g(v,54),alt:"avatar"})),r.a.createElement("span",{className:"username"+(b?" none":" animated slideInRight")},f)),r.a.createElement(A.b.Provider,{value:{color:"white",size:"20px"}},r.a.createElement(C.c,{onClick:function(e){e.preventDefault(),o.emit("logout"),p.logout(),h.push("/")},className:"react-button"}))))}function L(e){var t=e.title,a=e.barSwitch;return r.a.createElement("div",{className:"chat-header"},r.a.createElement("div",{className:"user-info"},r.a.createElement("div",{className:"user-name"},t)),r.a.createElement("div",{id:"chats-back",onClick:function(){a()}},r.a.createElement(C.e,null)))}function T(e){var t=e.message,a=e.me,s=e.name,c=e.avatarId,i=e.userId,o=Object(n.useState)("png"),u=Object(v.a)(o,2),m=u[0],d=u[1],f=Object(n.useState)(!1),b=Object(v.a)(f,2),p=b[0],h=b[1];Object(n.useEffect)((function(){var e=c.split("/")[1].split(".")[1];d(e)}),[c]);return r.a.createElement("div",{onMouseEnter:function(){h(!0)},onMouseLeave:function(){h(!1)},className:"message-container"+(a?" me":" ")},r.a.createElement("div",{className:"avatarFront"},r.a.createElement(l.b,{to:"/profile/".concat(i)},r.a.createElement("img",{src:function(e){return g("gif"===m&&p?e:"".concat(e.split(".")[0],".png"),69)}(c),alt:"avatar"}))),r.a.createElement("div",{className:"data"},r.a.createElement("div",{className:"message"},t),r.a.createElement("div",{className:"name"},s)))}var q=a(84),F=a.n(q);a(177);function B(e){var t=e.loader;return"main"===t?r.a.createElement("div",{className:"loader-container"},r.a.createElement("div",{className:"loadingio-spinner-dual-ball-1bcrbgm9zs1"},r.a.createElement("div",{className:"ldio-ws5kmlhv8h"},r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null)))):"messages"===t?r.a.createElement("div",{className:"loader-container"},r.a.createElement("div",{className:"loadingio-spinner-ripple-93sai1jh985"},r.a.createElement("div",{className:"ldio-bn935j38u6"},r.a.createElement("div",null),r.a.createElement("div",null)))):r.a.createElement("div",null)}function R(e){var t=e.setVisibleButton,a=e.messages,s=e.loading,c=Object(n.useState)(!0),l=Object(v.a)(c,2),i=l[0],o=l[1],u=Object(n.useState)(0),m=Object(v.a)(u,2),d=m[0],f=m[1],b=Object(n.useContext)(P);return Object(n.useEffect)((function(){E()}),[]),Object(n.useEffect)((function(){d!==a.length&&(f(a.length),a[a.length-1].username===b.username&&E(),i&&E())}),[a,b,d,i]),r.a.createElement("div",{className:"thread-container",id:"msgs",onScroll:function(){var e=document.getElementById("msgs"),a=e.scrollHeight-e.offsetHeight;a-.1*a<e.scrollTop?(t(!1),o(!0)):(t(!0),o(!1))}},s?r.a.createElement(B,{loader:"messages"}):r.a.createElement("div",{className:"thread",id:"msgsInner"},r.a.createElement(F.a,{transitionName:{enter:"animated",enterActive:"zoomIn",leave:"animated"}},a.map((function(e,t){return r.a.createElement(T,{className:"fast",key:t,message:e.text,me:b.userId===e.userId,name:e.username,avatarId:e.avatar,userId:e.userId})})))))}var z=a(85);function H(e){var t=e.visibleButton,a=e.socket,s=e.chat,c=e.typing,l=e.load,i=Object(n.useState)(""),o=Object(v.a)(i,2),u=o[0],m=o[1],d=Object(n.useState)(""),f=Object(v.a)(d,2),p=f[0],h=f[1],E=Object(n.useContext)(P),g=E.username,O=E.userId,j=E.avatar,w=new Date,N=w.setSeconds(w.getSeconds()+3),k=Object(z.useTimer)({timer:N,onExpire:function(){a.emit("send_typing_off",{username:g,chat:s})}}),y=k.restart,I=k.pause;Object(n.useEffect)((function(){if(!c[s])return h("");c[s].length<=0?h(""):1===c[s].length?h("".concat(c[s][0]," \u043a\u0430\u0441\u0442\u0443\u0435\u0442...")):2===c[s].length?h("".concat(c[s][0]," \u0438 ").concat(c[s][1]," \u043a\u0430\u0441\u0442\u0443\u044e\u0442...")):3===c[s].length?h("".concat(c[s][0],", ").concat(c[s][1]," \u0438 ").concat(c[s][2]," \u043a\u0430\u0441\u0442\u0443\u044e\u0442...")):h("\u041a\u0430\u0441\u0442\u0443\u0435\u0442\u0441\u044f \u043c\u0435\u0433\u0430\u0437\u0430\u043a\u043b\u0438\u043d\u0430\u043d\u0438\u0435...")}),[c,s]);var x=function(e){I(),a.emit("send_typing_off",{username:g,chat:s}),e&&(m(""),a.emit("send_message",{text:e,username:g,userId:O,avatar:j,chat:s}))};return r.a.createElement("div",null,r.a.createElement("div",{className:"scrollContainer"},r.a.createElement(b.Animated,{animationIn:"bounceIn",animationOut:"zoomOutDown",animationOutDuration:400,animationInDuration:400,isVisible:t,animateOnMount:!1},r.a.createElement("button",{id:"scrollBottom",onClick:function(){var e=document.getElementById("msgs");e.scrollTo({top:e.scrollHeight,behavior:"smooth"})}},r.a.createElement(A.b.Provider,{value:{color:"white",size:"26px"}},r.a.createElement(C.b,null))))),r.a.createElement("div",{className:"typing-user animated infinite pulse"},r.a.createElement("span",null,p)),r.a.createElement("div",{className:"message-input"},r.a.createElement("form",{onSubmit:function(e){e.preventDefault()},className:"message-form"},r.a.createElement("textarea",{id:"message",autoFocus:!0,type:"text",className:"form-control",value:u,autoComplete:"off",placeholder:"\u041d\u0430\u043f\u0438\u0448\u0438 \u0447\u0442\u043e-\u0442\u043e \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u043d\u043e\u0435",onChange:function(e){var t=e.target;m(t.value)},onKeyDown:function(e){if(("Enter"!==e.key||!e.shiftKey)&&"Enter"===e.key){if(e.preventDefault(),l)return;x(u)}},onKeyUp:function(e){if(!l&&"Enter"!==e.key){a.emit("send_typing_on",{username:g,chat:s});var t=new Date,n=t.setSeconds(t.getSeconds()+3);y(n)}}}),r.a.createElement("button",{disabled:l,type:"submit",className:"send",onClick:function(e){e.preventDefault(),document.getElementById("message").focus(),x(u)}}," \u27a4 "))))}a(178);var M=a(86),V=(a(210),a(30));function J(e){var t=e.username,a=e.userId,n=e.avatar;return r.a.createElement("div",{className:"friend-container"},r.a.createElement("div",null,r.a.createElement(l.b,{to:"/profile/".concat(a)},r.a.createElement("img",{className:"avatar",src:g(n,65),alt:"friend-avatar"}))),r.a.createElement("div",{className:"username"},t))}var U=a(29),K=a.n(U);function W(e){var t=e.username,a=e.userId,n=e.requestHandler;return r.a.createElement("div",{className:"request"},r.a.createElement("span",null,"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c ",t," \u0445\u043e\u0447\u0435\u0442 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432\u0430\u0441 \u0432 \u0434\u0440\u0443\u0437\u044c\u044f"),r.a.createElement("div",{className:"buttons"},r.a.createElement("button",{onClick:function(){n(a,!0)},className:"accept"},"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"),r.a.createElement("button",{onClick:function(){n(a,!1)},className:"cansel"},"\u041e\u0442\u043a\u043b\u043e\u043d\u0438\u0442\u044c")))}function G(e){var t=e.socket,a=e.setStatus,s=e.setAvatar,c=e.setEasterEgg,l=e.friends,i=e.requests,o=Object(n.useContext)(P),d=o.username,f=o.avatar,b=o.status,p=o.tag,h=o.userId,E=Object(n.useState)(""),j=Object(v.a)(E,2),w=j[0],k=j[1],y=Object(n.useState)(""),I=Object(v.a)(y,2),x=I[0],S=I[1],C=Object(n.useState)(g(null,180)),_=Object(v.a)(C,2),A=_[0],D=_[1],L=N().requestFormData;K()((function(){"dev"===p&&c(!0)}),{code:["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","b","a"]}),Object(n.useEffect)((function(){k(b),S(b),f&&D(g(f,180))}),[b,f]),Object(n.useEffect)((function(){t.emit("get_friend_requests"),t.emit("get_friends")}),[t,h]);var T=function(e,a){t.emit("request_handler",{userId:e,accept:a})},q=function(){var e=Object(m.a)(u.a.mark((function e(a){var n,r,c,l,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.target.files[0],(r=new FormData).append("file",n),r.append("upload_preset","da9k11cr"),D(g("v1581959183/levng698wjc23g8d5iua.gif",180)),e.prev=5,e.next=8,L("https://api.cloudinary.com/v1_1/sketchcorp/upload","POST",r);case 8:if(c=e.sent,l=c.data,i="v".concat(l.version,"/").concat(l.public_id,".").concat(l.format),D(g(i,180)),t.emit("update_avatar",{avatar:i}),s(i),"v1581973009/w1xcn5v6tl80hw72lpts.png"!==f){e.next=16;break}return e.abrupt("return");case 16:t.emit("delete_avatar",{avatar:f}),e.next=24;break;case 19:e.prev=19,e.t0=e.catch(5),console.log(e.t0),alert("\u041e\u0439\u0439\u0439\u0439... \u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a \u043f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u0430\u0432\u0430\u0442\u0430\u0440\u043a\u0438. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043d\u0430\u0436\u043c\u0438\u0442\u0435 Ctrl+Shift+I \u0438 \u0441\u0434\u0435\u043b\u0430\u0439\u0442\u0435 \u0441\u043a\u0440\u0438\u043d\u0448\u043e\u0442 \u043a\u043e\u043d\u0441\u043e\u043b\u0438. \u0421\u043f\u0430\u0441\u0438\u0431\u043e ^^ -\u0421\u043a\u0435\u0442\u0447"),D(g(f,180));case 24:case"end":return e.stop()}}),e,null,[[5,19]])})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"profile-container"},r.a.createElement("div",{className:"user-data"},r.a.createElement("div",null,r.a.createElement("div",{className:"image-upload"},r.a.createElement("label",{htmlFor:"avatar-input"},r.a.createElement("div",{className:"cover"},"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c"),r.a.createElement("img",{src:A,alt:"avatar"})),r.a.createElement("input",{onChange:q,id:"avatar-input",type:"file",accept:"image/*"}))),r.a.createElement("div",{className:"data-wrapper"},r.a.createElement("div",{className:"username"},d," ",O(p)),r.a.createElement(V.a,{maxLength:"190",className:"status",type:"text",value:w,onChange:function(e){var t=e.target;k(t.value)},onBlur:function(e){e.target.value=x},onKeyPress:function(e){"Enter"===e.key&&(S(e.target.value),a(e.target.value),t.emit("update_status",{status:e.target.value}),e.target.blur())}}))),r.a.createElement("div",{className:"requests-container"},i.map((function(e,t){var a=e.username,n=e.userId;return r.a.createElement(W,{key:t,username:a,userId:n,requestHandler:T})})))),r.a.createElement("div",{className:"friends-header"},"\u0414\u0440\u0443\u0437\u044c\u044f"),r.a.createElement("div",{className:"friends-container",id:"msgs"},r.a.createElement("div",{className:"friends",id:"msgsInner"},l.map((function(e,t){var a=e.username,n=e.userId,s=e.avatar;return r.a.createElement(J,{key:t,username:a,userId:n,avatar:s})})))),r.a.createElement("div",{className:"friends-footer"}))}function $(){var e=Object(n.useState)(!1),t=Object(v.a)(e,2),a=t[0],s=t[1],c=new Audio("/sounds/lightOff.mp3");return function(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=r.persistRenders,c=void 0!==s&&s,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:setTimeout,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:clearTimeout,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:n.useEffect,u=function(){return t&&i(t)};o((function(){return t=l(e,a),u}),c?[l,i]:[e,a,l,i])}((function(){s(!0)}),3e3,{persistRenders:!1}),Object(n.useEffect)((function(){c.play()}),[c]),a?r.a.createElement("div",{className:"easter-egg"},r.a.createElement("video",{autoPlay:!0,src:"/videos/dark.mp4"})):r.a.createElement("div",{className:"easter-egg"},r.a.createElement("div",null))}a(212);function Q(e){var t=e.socket,a=e.setEasterEgg,s=e.usersProfile,c=Object(n.useContext)(P).userId,l=Object(n.useState)(!0),o=Object(v.a)(l,2),u=o[0],m=o[1],d=Object(n.useState)(""),f=Object(v.a)(d,2),b=f[0],p=f[1],h=Object(n.useState)(g(null,180)),E=Object(v.a)(h,2),j=E[0],w=E[1],N=Object(n.useState)(""),k=Object(v.a)(N,2),y=k[0],I=k[1],x=Object(n.useState)(""),S=Object(v.a)(x,2),C=S[0],_=S[1],A=Object(n.useState)([]),D=Object(v.a)(A,2),L=D[0],T=D[1],q=Object(n.useState)(!1),F=Object(v.a)(q,2),B=F[0],R=F[1],z=Object(i.g)(),H=Object(i.h)().id;K()((function(){"dev"===s[H].tag&&a(!0)}),{code:["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","b","a"]}),Object(n.useEffect)((function(){if(c===H)return z.push("/profile");if(s[H]){if(!s[H].exist)return z.push("/profile");for(var e=0;e<s[H].friends.length;e++)s[H].friends[e].userId===c&&R(!0);m(!1),I(s[H].username),p(s[H].status),w(g(s[H].avatar,180)),_(s[H].tag),T(s[H].friends)}}),[H,s,z,c]),Object(n.useEffect)((function(){t.emit("get_other_user",{userId:H})}),[t,H]);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"other-profile-container"},r.a.createElement("div",{className:"user-data"},r.a.createElement("div",null,r.a.createElement("div",{className:"image-upload"},r.a.createElement("label",{htmlFor:"avatar-input"},r.a.createElement("img",{src:j,alt:"avatar"})))),r.a.createElement("div",{className:"data-wrapper"},r.a.createElement("div",{className:"username"},y," ",O(C)),r.a.createElement(V.a,{maxLength:"190",className:"status",type:"text",value:b,readOnly:!0}),r.a.createElement("div",{className:"buttons"},r.a.createElement("button",{disabled:!0},"\u041d\u0430\u043f\u0438\u0441\u0430\u0442\u044c"),B?r.a.createElement("button",{disabled:u,onClick:function(){R(!1),t.emit("delete_friend",{friendId:H}),t.emit("get_other_user",{userId:H})}},"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0438\u0437 \u0434\u0440\u0443\u0437\u0435\u0439"):r.a.createElement("button",{disabled:u,onClick:function(){t.emit("add_friend",{friendId:H}),alert("\u0417\u0430\u043f\u0440\u043e\u0441 \u0432 \u0434\u0440\u0443\u0437\u044c\u044f \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d!")}},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u0434\u0440\u0443\u0437\u044c\u044f"))))),r.a.createElement("div",{className:"friends-header"},"\u0414\u0440\u0443\u0437\u044c\u044f"),r.a.createElement("div",{className:"friends-container",id:"msgs"},r.a.createElement("div",{className:"friends",id:"msgsInner"},L.map((function(e,t){var a=e.username,n=e.userId,s=e.avatar;return r.a.createElement(J,{key:t,username:a,userId:n,avatar:s})})))),r.a.createElement("div",{className:"friends-footer"}))}function X(e){var t=e.chatRoute,a=e.otherProfile,s=Object(n.useContext)(y),c=Object(n.useState)(!0),l=Object(v.a)(c,2),o=l[0],u=l[1],m=Object(n.useState)(!1),p=Object(v.a)(m,2),h=p[0],E=p[1],g=Object(n.useState)(!1),O=Object(v.a)(g,2),j=O[0],w=O[1],N=Object(i.g)(),k=Object(n.useState)({username:"",avatar:"",userId:"",status:"",load:!0}),I=Object(v.a)(k,2),x=I[0],C=I[1],_=Object(n.useState)("community"),A=Object(v.a)(_,1)[0],T=Object(n.useState)(!0),q=Object(v.a)(T,2),F=q[0],B=q[1],z=Object(n.useState)({}),V=Object(v.a)(z,2),J=V[0],U=V[1],K=Object(n.useState)({}),W=Object(v.a)(K,2),X=W[0],Y=W[1],Z=function(){var e=Object(n.useState)([0,0]),t=Object(v.a)(e,2),a=t[0],r=t[1];return Object(n.useLayoutEffect)((function(){function e(){r([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",e),e(),function(){return window.removeEventListener("resize",e)}}),[]),a}(),ee=Object(v.a)(Z,1)[0],te=Object(n.useState)(!1),ae=Object(v.a)(te,2),ne=ae[0],re=ae[1],se=Object(n.useState)({}),ce=Object(v.a)(se,2),le=ce[0],ie=ce[1],oe=Object(n.useState)([]),ue=Object(v.a)(oe,2),me=ue[0],de=ue[1],fe=Object(n.useState)([]),ve=Object(v.a)(fe,2),be=ve[0],pe=ve[1],he=Object(M.a)({query:{token:s.token},autoConnect:!1}),Ee=Object(v.a)(he,1)[0];function ge(){ee>510||(o?setTimeout((function(e){e(!0)}),400,E):E(!1),u(!o))}Object(n.useEffect)((function(){return Ee.on("connect",(function(){})),Ee.on("reload",(function(){s.reload()})),Ee.on("logout",(function(){s.logout(),N.push("/")})),Ee.on("load_user_info",(function(e){C(Object(f.a)({},e,{load:!1}))})),Ee.on("load_messages",(function(e){B(!1);var t=null;if(e.length>0){var a=e[e.length-1].text,n=a.slice(0,15);n.length<a.length&&(n+="..."),t=Object(f.a)({},e[e.length-1],{text:n})}U(Object(d.a)({},"community",{messages:Object(S.a)(e),last:t,typing:[]}))})),Ee.on("push_message",(function(e){var t=e.chat,a=e.username,n=e.userId,r=e.text,s={username:a,userId:n,text:r,avatar:e.avatar},c=J[t]?J[t].messages:[],l=J[t]?J[t].typing:[],i=r.slice(0,15);i.length<r.length&&(i+="..."),U(Object(f.a)({},J,Object(d.a)({},t,{messages:[].concat(Object(S.a)(c),[s]),last:Object(f.a)({},s,{text:i}),typing:Object(S.a)(l)})))})),Ee.on("push_typing_on",(function(e){var t=e.username,a=e.chat,n=X[a]?X[a]:[];n.indexOf(t)<0&&n.push(t),n.indexOf(x.username)>-1&&n.splice(n.indexOf(x.username),1),Y(Object(f.a)({},X,Object(d.a)({},a,n)))})),Ee.on("push_typing_off",(function(e){var t=e.username,a=e.chat,n=X[a]?X[a]:[];n.indexOf(t)>-1&&n.splice(n.indexOf(t),1),Y(Object(f.a)({},X,Object(d.a)({},a,n)))})),Ee.on("push_other_user",(function(e){var t=e.exist,a=e.userId,n=e.username,r=e.status,s=e.avatar,c=e.tag,l=e.friends;if(!t)return ie(Object(f.a)({},le,Object(d.a)({},a,{exist:!1})));ie(Object(f.a)({},le,Object(d.a)({},a,{exist:!0,username:n,status:r,avatar:s,tag:c,friends:l})))})),Ee.on("push_friend_requests",(function(e){de(e)})),Ee.on("push_friends",(function(e){console.log("push_friends"),pe(e)})),function(){Ee.removeAllListeners()}}),[Ee,J,N,s,x,X,le]),Object(n.useEffect)((function(){Ee.connect()}),[Ee]);return ne?r.a.createElement($,null):r.a.createElement(P.Provider,{value:{username:x.username,avatar:x.avatar,userId:x.userId,status:x.status,tag:x.tag,load:x.load}},r.a.createElement("link",{rel:"stylesheet",href:"/themes/Dark.css"}),r.a.createElement("div",{className:"container"},t?r.a.createElement(b.Animated,{style:ee<=510?{width:"100%",height:"100%"}:{width:"76.25%",height:"100%"},animationIn:"slideInLeft",animationOut:"slideOutLeft",animationInDuration:400,animationOutDuration:400,isVisible:o,animateOnMount:!1},r.a.createElement("div",{style:{width:"100%"},className:"chat-room-container"+(h?" chat-hide":" chat-active")},r.a.createElement("div",{className:"chat-room"},r.a.createElement(L,{title:"Community",barSwitch:ge}),r.a.createElement(R,{messages:J[A]?J[A].messages:[],setVisibleButton:w,visibleButton:j,loading:F}),r.a.createElement(H,{load:F,typing:X,chat:A,socket:Ee,visibleButton:j})))):r.a.createElement(b.Animated,{style:ee<=510?{width:"100%",height:"100%"}:{width:"76.25%",height:"100%"},animationIn:"slideInLeft",animationOut:"slideOutLeft",animationInDuration:400,animationOutDuration:400,isVisible:o,animateOnMount:!1},r.a.createElement("div",{style:{width:"100%"},className:"chat-room-container"+(h?" chat-hide":" chat-active")},r.a.createElement("div",{className:"chat-room"},r.a.createElement(L,{title:"\u041f\u0440\u043e\u0444\u0438\u043b\u044c",barSwitch:ge}),a?r.a.createElement(Q,{usersProfile:le,setEasterEgg:re,socket:Ee}):r.a.createElement(G,{friends:be,requests:me,setAvatar:function(e){C(Object(f.a)({},x,{avatar:e}))},setEasterEgg:re,setStatus:function(e){C(Object(f.a)({},x,{status:e}))},socket:Ee})))),r.a.createElement(D,{chatRoute:t,chats:J,chat:A,socket:Ee,viewState:ee<=510&&!o,chatSwitch:ge,hide:ee<=510&&!h})))}var Y=function(){var e=function(){var e=Object(n.useState)(null),t=Object(v.a)(e,2),a=t[0],r=t[1],s=Object(n.useState)(!1),c=Object(v.a)(s,2),l=c[0],i=c[1],o=Object(n.useState)(null),u=Object(v.a)(o,2),m=u[0],d=u[1],f=Object(n.useState)(null),b=Object(v.a)(f,2),p=b[0],h=b[1],E=Object(n.useCallback)((function(e,t,a){r(e),d(t),h(a),localStorage.setItem("Pony",JSON.stringify({token:e,userId:t,username:a}))}),[]),g=Object(n.useCallback)((function(){r(null),d(null),h(null),localStorage.removeItem("Pony")}),[]),O=Object(n.useCallback)((function(){var e=JSON.parse(localStorage.getItem("Pony"));e&&e.token||g()}),[g]);return Object(n.useEffect)((function(){var e=JSON.parse(localStorage.getItem("Pony"));e&&e.token&&E(e.token,e.userId,e.username),i(!0)}),[E]),{login:E,logout:g,token:a,reload:O,userId:m,username:p,ready:l}}(),t=e.token,a=e.login,s=e.logout,c=e.reload,o=e.userId,u=e.ready,m=!!t,d=function(e){return e?r.a.createElement(i.d,null,r.a.createElement(i.b,{path:"/chat",exact:!0},r.a.createElement(X,{chatRoute:!0})),r.a.createElement(i.b,{path:"/profile",exact:!0},r.a.createElement(X,null)),r.a.createElement(i.b,{path:"/profile/:id",exact:!0},r.a.createElement(X,{otherProfile:!0})),r.a.createElement(i.a,{to:"/chat"})):r.a.createElement(i.d,null,r.a.createElement(i.b,{path:"/login",exact:!0},r.a.createElement(I,null)),r.a.createElement(i.b,{path:"/register",exact:!0},r.a.createElement(x,null)),r.a.createElement(i.a,{to:"/login"}))}(m);return u?r.a.createElement(y.Provider,{value:{token:t,login:a,logout:s,reload:c,userId:o,isAuthenticated:m}},r.a.createElement(l.a,null,d)):r.a.createElement(B,{loader:"main"})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(Y,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},88:function(e,t,a){e.exports=a(213)},93:function(e,t,a){}},[[88,1,2]]]);
//# sourceMappingURL=main.d52f1b1d.chunk.js.map